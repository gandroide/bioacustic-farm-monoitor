# üê∑ ONTIVEROS BIO-ALERT - Project Master Context

## 1. Identidad y Prop√≥sito
* **Nombre del Proyecto:** Ontiveros Bio-Alert (Bio-Alert).
* **Objetivo:** Sistema de monitoreo bioac√∫stico para granjas porcinas. Detecta aplastamiento de lechones mediante IA y alerta al granjero en tiempo real.
* **Estado Actual:** MVP Funcional (Frontend + Backend + Script Python).
* **Meta Inmediata:** Transformar en plataforma SaaS Multi-Tenant para recolectar datos de m√∫ltiples granjas.

## 2. Arquitectura T√©cnica (Monorepo)
El proyecto convive en un solo repositorio con dos partes diferenciadas:

### A. Edge (Raspberry Pi / Local)
* **Ubicaci√≥n:** Ra√≠z del proyecto.
* **Lenguaje:** Python (`main.py`).
* **Librer√≠as:** PyAudio, Librosa, NumPy, Supabase-py.
* **Funci√≥n:** Escucha el micr√≥fono, detecta eventos (simulados o reales), graba el clip de audio y lo sube a Supabase Storage + Database.

### B. Cloud Web App (Frontend)
* **Ubicaci√≥n:** Carpeta `/bioalert-web`.
* **Framework:** Next.js 14 (App Router) + TypeScript.
* **Estilos:** Tailwind CSS + Shadcn/UI (Dark Mode Industrial).
* **Hosting:** Vercel (`https://bioacoustic-farm-monitor.vercel.app`).
* **Caracter√≠sticas Clave:**
    * **PWA:** Instalable en m√≥viles (gracias a `@ducanh2912/next-pwa`).
    * **Audio:** Visualizaci√≥n de ondas con `wavesurfer.js`.
    * **Real-time:** Suscripci√≥n a cambios en Supabase para alertas instant√°neas.
    * **Internacionalizaci√≥n:** Preparado para `next-intl` (ES, PT, EN).

### C. Backend (BaaS)
* **Plataforma:** Supabase.
* **Tablas Clave:** `events` (alertas), `devices` (sensores).
* **Auth:** Supabase Auth.
* **Storage:** Bucket `audio-clips` para los archivos .wav.

## 3. Soluciones T√©cnicas Importantes (NO TOCAR)
1.  **Deploy en Vercel:** Se configur√≥ el "Root Directory" en Vercel como `bioalert-web`.
2.  **Fix de Build:** En `lib/supabase.ts`, usamos un fallback (`|| 'placeholder'`) para las variables de entorno `NEXT_PUBLIC_SUPABASE_ANON_KEY`. Esto evita que el build falle en Vercel durante la generaci√≥n est√°tica.
3.  **Componentes:** Los Iconos de Lucide-React se manejan din√°micamente en `kpi-cards.tsx` (se corrigi√≥ un bug de `undefined`).

## 4. PR√ìXIMO PASO: Implementaci√≥n Multi-Tenancy (SaaS)
Vamos a pasar de "Single Farm" a "Multi-Farm" para permitir recolectar datos de varios clientes/granjas vecinas y entrenar el modelo de ML.

**Requerimientos para el Agente:**
1.  **Base de Datos:**
    * Crear tabla `farms`.
    * Vincular `users`, `events` y `devices` a un `farm_id`.
2.  **Seguridad (RLS):**
    * Implementar Row Level Security estricto. Un usuario de la "Granja A" NUNCA debe ver datos de la "Granja B".
3.  **Roles:**
    * `Super Admin` (Yo, Ontiveros): Veo todo, creo granjas, descargo audios para ML.
    * `Farm Admin`: Solo ve su granja.
4.  **Frontend:**
    * Crear ruta `/admin` (solo para Super Admin) para gestionar altas de granjas.
    * Asegurar que el Dashboard actual filtre autom√°ticamente por la granja del usuario.

## 5. DESIGN SYSTEM & UI GUIDELINES (INMUTABLE)
Cualquier nueva funcionalidad debe respetar estrictamente estas reglas visuales para mantener la coherencia.

### A. Filosof√≠a Visual ("The Vibe")
* **Estilo:** "Industrial Clean" / "Sci-Fi Dashboard". Minimalista, oscuro, alto contraste.
* **Prop√≥sito:** Herramienta profesional de monitoreo cr√≠tico. No debe parecer una red social ni una web corporativa gen√©rica.
* **Modo:** **Dark Mode Only**. No implementar Light Mode.

### B. Paleta de Colores (Tailwind)
* **Fondo Principal:** `bg-slate-950` o `bg-black`.
* **Superficies (Tarjetas):** `bg-card` con bordes sutiles (`border-border/50`) y efectos de cristal (`backdrop-blur`).
* **Color Primario (Marca):** Naranja Seguridad (`text-amber-500` / `bg-amber-500`). Usado para logos y acentos principales.
* **Sem√°ntica de Estados:**
    * üö® **Peligro/Alerta:** `text-red-500` / `bg-red-500/10` (Glow effects).
    * ‚ö†Ô∏è **Advertencia:** `text-amber-500` / `bg-amber-500/10`.
    * ‚úÖ **Seguro/Operativo:** `text-emerald-500` / `bg-emerald-500/10`.
    * ‚ÑπÔ∏è **Info/Neutro:** `text-slate-400`.

### C. Tipograf√≠a
* **Principal:** `Inter` (Sans-serif) para textos generales.
* **Datos T√©cnicos:** `Geist Mono` o `Monospace` para IDs, timestamps, coordenadas y lecturas de sensores.

### D. Componentes & UX
* **Librer√≠a UI:** Usar exclusivamente **Shadcn/UI**. No mezclar con otras librer√≠as de estilos.
* **Iconograf√≠a:** **Lucide-React**. Grosor de l√≠nea `strokeWidth={2}` o `1.5` para elegancia.
* **Feedback Visual:**
    * Los elementos interactivos deben tener estados `:hover` claros.
    * Usar "Glow Effects" (sombras de color) para destacar KPIs cr√≠ticos.
* **Mobile First (PWA):**
    * Botones de acci√≥n (Play, Refresh) deben tener un √°rea de toque m√≠nima de 44px.
    * Evitar tablas anchas en m√≥vil; usar tarjetas (Cards) o listas apiladas.
## 6. ROADMAP T√âCNICO & ADVERTENCIAS (LEER ANTES DE TOCAR C√ìDIGO)

### A. ‚ö†Ô∏è Zona de Peligro: Internacionalizaci√≥n (i18n)
* **Estado:** FALLIDA Y REVERTIDA.
* **Historial:** Se intent√≥ implementar `next-intl` previamente y rompi√≥ la estructura del proyecto y el despliegue.
* **Instrucci√≥n Estricta:** NO intentar reimplementar i18n (idiomas) hasta que la funcionalidad Multi-Tenant est√© 100% estable y desplegada en producci√≥n.
* **Estrategia Futura:** Cuando se retome, hacerlo en una rama separada (`feature/i18n`) y NUNCA directamente en main. Priorizar la estabilidad del Dashboard sobre los idiomas por ahora.

### B. Gesti√≥n de Assets PWA (Iconos)
* **Recurso Origen:** Existe un archivo maestro llamado `icono` (puede ser .png/.jpg) en la carpeta `/public`.
* **Tarea Pendiente:** El Agente debe tomar ese archivo y generar autom√°ticamente los assets requeridos por el `manifest.json`:
    1.  Renombrar/Convertir a `icon-192x192.png`.
    2.  Renombrar/Convertir a `icon-512x512.png`.
    3.  Asegurar que el `manifest.json` apunte a estos nuevos archivos para que la instalaci√≥n en el m√≥vil muestre el logo correcto y no el de Vercel/Next.js por defecto.

### C. Estabilidad del Despliegue
* **Regla de Oro:** Si un cambio requiere modificar `next.config.mjs` o el `middleware.ts`, se debe verificar doblemente que no rompa el build en Vercel. (Recordar el fix de `d3-ease` y las variables de entorno).
---
*Fin del contexto. Por favor, act√∫a como Arquitecto Senior y ay√∫dame a implementar el punto 4.*